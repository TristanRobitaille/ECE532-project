#ifndef INC_I2S_AUDIO_H_
#define INC_I2S_AUDIO_H_

#include "xparameters.h"
#include "xil_io.h"
#include "stdlib.h"

//----- DEFINES -----//
#define I2S_DATA_REG XPAR_I2S_AUDIO_AXI_I2S_DRIVER_0_S00_AXI_BASEADDR
#define I2S_EN_REG (I2S_DATA_REG + 0x4)
#define I2S_DATA_WIDTH_REG (I2S_DATA_REG + 0x8)
#define I2S_CLK_DIV_REG (I2S_DATA_REG + 0xC)

#define I2S_DEFAULT_DATA_WIDTH 32
// For 20kHz refresh (need to send 2x32b per refresh), need bclk = 1.28MHz ~= 1.32MHz --> BCLK_DIV = 38
// MCLK sets the sampling frequency as f_sampling = MCLK/256. For 20kHz sampling, MCLK = 5.12MHz ~= 5MHz--> MCLK_DIV = 10
#define I2S_DEFAULT_BCLK_DIV 38 // bclk = 100MHz/2*BCLK_DIV
#define I2S_DEFAULT_MCLK_DIV 10 // mclk = 100MHz/2*BCLK_DIV

// I2C interface
#define ADAU1761_I2C_ADDR 0b01101110 // See datasheet page 38. On Nexys Video, ADDR0 == ADDR1 == 1
#define ADAU1761_MIXER_5_CTRL_REG 0x4020 // R26 (mixer 5)
#define ADAU1761_MIXER_6_CTRL_REG 0x4021 // R27 (mixer 6)
#define ADAU1761_LEFT_LINE_OUT_VOL_REG 0x4025 // R31
#define ADAU1761_RIGHT_LINE_OUT_VOL_REG 0x4026 // R32

// TODO: Do I need to change R58?
//#define ADAU1761_SERIAL_IN_DATA_ROUTING_REG 0x // R58
#define ADAU1761_MIXER_CTRL 0b00010101 //6dB gain on both mixers and enable (same settings for R26 and R27)

/* Settings we need
 * Datasheet page 37:
 * 	Line out jack on Nexys Video is connected between LOUTP and ROUTP
 * 	Left DAC goes through Mixer 3 and 5 and volume adjustment --> Set MX5G3[1:0] and LOUTVOL[5:0]
 * 	Right DAC goes through Mixer 4 and 6 and volume adjustment --> Set MX6G4[1:0] and ROUTVOL[5:0]
 * 	To drive loads of 16R or more, need to change to headphone mode --> Set LOMODE bit in R31 and ROMODE bit in R32
 */


//----- PROTOTYPES -----//
void i2s_audio_init();
void i2s_audio_enable();
void i2s_audio_disable();
void i2s_audio_set_data_width(u32 data_width);
void i2s_audio_set_bclk_div(u32 bclk_div);
void i2s_audio_set_mclk_div(u32 mclk_div);
void i2s_audio_write_data(u32 data);

#endif /* INC_I2S_AUDIO_H_ */
